  <div class="container py-5">
    <h1 class="mb-4 text-light">Listado de Usuarios Registrados</h1>

    <!-- Tabla estática en el HTML; el cuerpo (<tbody>) se llenará dinámicamente -->
    <table class="table table-striped table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th scope="col">#</th>
          <th scope="col">Usuario</th>
          <th scope="col">Nombre</th>
          <th scope="col">Apellido</th>
          <th scope="col">Correo</th>
          <th scope="col">Teléfono</th>
          <th scope="col">Ciudad</th>
          <th scope="col">Provincia</th>
          <th scope="col">Fecha Nac.</th>
          <th scope="col">Ubicación</th>
          <th scope="col">Eliminar</th>
        </tr>
      </thead>
      <tbody id="usersTableBody">
        <!-- Aquí se inyectarán las filas de usuarios -->
      </tbody>
    </table>
  </div>

  <script>
    // —————————————————————————————
    // OBTIENE TODOS LOS OBJETOS DE USUARIO DESDE localStorage
    // Cada clave en localStorage es el nombre de usuario,
    // y su valor es un JSON con las propiedades: nombre, apellido,
    // email, fecha_nacimiento, foto, provincia, ciudad, telefono, ubicacion, usuario, password.
    function obtenerTodosLosUsuarios() {
      const usuarios = [];
      for (let i = 0; i < localStorage.length; i++) {
        const clave = localStorage.key(i);
        const valor = localStorage.getItem(clave);
        try {
          const obj = JSON.parse(valor);
          // Verificamos que tenga la propiedad 'usuario' y coincida con la clave
          if (obj && obj.usuario === clave) {
            usuarios.push(obj);
          }
        } catch (e) {
          // Ignoramos valores que no sean JSON válido o no tengan la estructura esperada
        }
      }
      return usuarios;
    }

    // —————————————————————————————
    // LLENA EL <tbody> DE LA TABLA CON TODOS LOS USUARIOS
    function cargarUsuariosEnTabla() {
      const tbody = document.getElementById("usersTableBody");
      tbody.innerHTML = ""; // Limpiamos contenido previo

      const usuarios = obtenerTodosLosUsuarios();
      if (usuarios.length === 0) {
        // Si no hay usuarios, mostramos una fila informativa
        const fila = document.createElement("tr");
        fila.innerHTML = `
          <td colspan="11" class="text-center text-muted">
            No hay usuarios almacenados.
          </td>
        `;
        tbody.appendChild(fila);
        return;
      }

      usuarios.forEach((u, index) => {
        const fila = document.createElement("tr");
        fila.id = `fila-${u.usuario}`;

        fila.innerHTML = `
          <th scope="row">${index + 1}</th>
          <td>${u.usuario}</td>
          <td>${u.nombre}</td>
          <td>${u.apellido}</td>
          <td>${u.email}</td>
          <td>${u.telefono}</td>
          <td>${u.ciudad}</td>
          <td>${u.provincia}</td>
          <td>${u.fecha_nacimiento}</td>
          <td>
            <button
              class="btn btn-sm btn-info"
              onclick="verUbicacion('${u.usuario}')"
            >
              Ver Ubicación
            </button>
          </td>
          <td>
            <button
              class="btn btn-sm btn-danger"
              onclick="eliminarUsuario('${u.usuario}')"
            >
              Eliminar
            </button>
          </td>
        `;
        tbody.appendChild(fila);
      });
    }

    // —————————————————————————————
    // MUESTRA LA UBICACIÓN GUARDADA DEL USUARIO
    // Lee la propiedad 'ubicacion' del objeto en localStorage y la muestra en un alert
    function verUbicacion(userName) {
      const valor = localStorage.getItem(userName);
      if (!valor) {
        alert("No se encontró el usuario en localStorage.");
        return;
      }
      try {
        const usuario = JSON.parse(valor);
        if (usuario.ubicacion) {
          alert(`Ubicación de ${userName}:\n${usuario.ubicacion}`);
        } else {
          alert("Este usuario no tiene ubicación guardada.");
        }
      } catch (e) {
        alert("Error leyendo los datos del usuario.");
      }
    }

    // —————————————————————————————
    // ELIMINA EL USUARIO DE localStorage Y REFRESCA LA TABLA
    function eliminarUsuario(userName) {
      localStorage.removeItem(userName);
      cargarUsuariosEnTabla();
    }

    // —————————————————————————————
    // CUANDO EL DOM ESTÉ CARGADO, PINTAMOS LA TABLA
    document.addEventListener("DOMContentLoaded", function () {
      cargarUsuariosEnTabla();
    });
  </script>